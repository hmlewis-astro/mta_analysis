# How To:

The code for this analysis is broken into multiple pieces to avoid re-running pieces that take a significant amount of time. To produce the results presented here, run the code in the following order:

- `sh heat_data/single_process.sh new-york new-york` &mdash; given a NASA Landsat 8 image, [this script](https://github.com/hmlewis-astro/mta_analysis/blob/main/heat_data/single_process.sh) (1) removes bodies of water, (2) converts the extracted spectral radiance to degrees Kelvin, and produces a simplified output for mapping on the web; the results are written to the `heat_data/data/output/analysis_out/final/new-york.geojson` file
- `python mta_analysis.py` &mdash; [this script](https://github.com/hmlewis-astro/mta_analysis/blob/main/mta_analysis.py) (1) downloads the MTA data and creates an SQL database for the year 2018, (2) adds the `geocoded.csv` file as a table in that database, (3) queries that database with SQLAlchemy, (4) cleans and aggregates the data (e.g., correcting for turnstiles counting in reverse, sets a limit on the maximum number of entries per observation period based on the duration of the observation period, and calculates the sum of the entries for each station), and (5) derives the "crowd index"; the results are written to the `mta_data_analyzed.csv` file
- `python mta_heat_analysis.py` &mdash; [this script](https://github.com/hmlewis-astro/mta_analysis/blob/main/mta_heat_analysis.py) (1) converts the derived surface temperatures from degrees Kelvin to degrees F and removes outliers, (2) derives the "heat index" over the entire region, (3) assigns a heat index to each station based on its geolocation, and (4) makes some maps of the crowd and heat indices; the results are written to the `mta_heat_data_analyzed.csv` file
-  `python mta_heat_final.py` &mdash; [this script](https://github.com/hmlewis-astro/mta_analysis/blob/main/mta_heat_final.py) (1) calculates the risk index (which is the weighted, quadrature sum of the crowd and heat indices), (2) creates a static map of the risk index, and (3) searches the area around high-risk stations for lower-risk options that service one (or more) of the same lines; these results are written to the `heat_risk_index.csv` file, which is then uploaded to the Tableau dashboard to create an interactive map
